# GPT Review Protocol (MANDATORY)

GPT cross-model review is **enabled**. **ONE-SHOTTING > VELOCITY.** Getting code right matters more than speed.

## Core Principle: The Uncertainty Rule

**If you are debating whether to skip GPT review, that uncertainty is a signal TO USE IT.** When in doubt, review.

## Code Reviews

After code changes (Edit/Write on code files), run GPT review:

```bash
.claude/scripts/gpt-review-api.sh code <changed-file>
```

**ALWAYS review (no exceptions)**:
- Backend code, API endpoints, database queries
- Security-sensitive code (auth, crypto, input validation)
- Business logic, state management, data transformations
- New files, major refactors

**Frontend/UI work**:
- You MAY batch multiple UI changes into a single review
- You MUST run review when the feature is complete
- Do not let momentum cause you to skip the final review

**OK to skip** (truly trivial):
- Typo fixes in strings or comments
- Log message changes
- Import reordering
- Version bumps
- Adding/removing console.log for debugging

## Document Reviews (Workflow Phases)

### After PRD Generation (`/plan-and-analyze`)
```bash
.claude/scripts/gpt-review-api.sh prd grimoires/loa/prd.md
```

### After SDD Generation (`/architect`)
```bash
.claude/scripts/gpt-review-api.sh sdd grimoires/loa/sdd.md
```

### After Sprint Plan Generation (`/sprint-plan`)
```bash
.claude/scripts/gpt-review-api.sh sprint grimoires/loa/sprint.md
```

### After Task Implementation (`/implement`)
For each modified file:
```bash
.claude/scripts/gpt-review-api.sh code <file>
```

## Handling Verdicts

| Verdict | Action |
|---------|--------|
| `SKIPPED` | Continue (review disabled at phase level) |
| `APPROVED` | Continue (no issues found) |
| `CHANGES_REQUIRED` | Fix the issues, then re-run with iteration tracking |
| `DECISION_NEEDED` | Ask user via AskUserQuestion, then re-run (documents only) |

## Iteration Tracking (CRITICAL)

When re-reviewing after fixes, pass iteration context so GPT verifies fixes:

```bash
# Save first response
echo "$response" > /tmp/gpt-review-findings-1.json

# After fixing issues, run iteration 2+
.claude/scripts/gpt-review-api.sh <type> <file> \
  --iteration 2 \
  --previous /tmp/gpt-review-findings-1.json
```

Maximum 3 iterations per file. After iteration 3, auto-approve and proceed with warning.
