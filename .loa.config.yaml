# Loa Framework Configuration
# This file is yours to customize - framework updates will never modify it

# =============================================================================
# Persistence Mode
# =============================================================================
# - standard: Commit grimoire and beads to repo (default)
# - stealth: Add state files to .gitignore, local-only operation
persistence_mode: standard

# =============================================================================
# Integrity Enforcement (Projen-Level)
# =============================================================================
# - strict: Block agent execution on System Zone drift (recommended, mandatory for CI)
# - warn: Warn but allow execution (development only)
# - disabled: No integrity checks (not recommended)
integrity_enforcement: strict

# =============================================================================
# Drift Resolution Policy
# =============================================================================
# - code: Update documentation to match implementation (existing codebases)
# - docs: Create beads to fix code to match documentation (greenfield)
# - ask: Always prompt for human decision
drift_resolution: code

# =============================================================================
# Agent Configuration
# =============================================================================
disabled_agents: []
# disabled_agents:
#   - auditing-security
#   - translating-for-executives

# =============================================================================
# Custom Paths
# =============================================================================
paths:
  grimoire: loa-grimoire
  beads: .beads

# =============================================================================
# Structured Agentic Memory (Anthropic-Level)
# =============================================================================
memory:
  # Persistent working memory file
  notes_file: loa-grimoire/NOTES.md
  # Trajectory logs for ADK-style evaluation
  trajectory_dir: loa-grimoire/a2a/trajectory
  # Auto-compact trajectory logs older than N days
  trajectory_retention_days: 30
  # Restore context from NOTES.md on session start
  auto_restore: true

# =============================================================================
# Evaluation-Driven Development (ADK-Level)
# =============================================================================
edd:
  enabled: true
  # Require N test scenarios before marking task complete
  min_test_scenarios: 3
  # Audit reasoning trajectory for hallucination
  trajectory_audit: true
  # Require explicit grounding for all claims
  require_citations: true

# =============================================================================
# Context Hygiene
# =============================================================================
compaction:
  enabled: true
  # Trigger compaction after this many closed tasks in a sprint
  threshold: 5

# =============================================================================
# Integrations
# =============================================================================
integrations:
  - github
  - linear

# =============================================================================
# Drift Detection (Sprint 4 - FR-9.1, GitHub Issue #10)
# =============================================================================
drift_detection:
  # Directories to watch for changes
  watch_paths:
    - ".claude/"
    - "loa-grimoire/"
    # Add custom directories as needed:
    # - ".meta/"
    # - "docs/architecture/"

  # Patterns to exclude from drift detection
  exclude_patterns:
    - "**/node_modules/**"
    - "**/*.log"
    - "**/.DS_Store"
    - "**/dist/**"
    - "**/build/**"
    - "**/__pycache__/**"

# =============================================================================
# Context Filtering (Sprint 4 - FR-9.2, GitHub Issue #10)
# =============================================================================
context_filtering:
  # Master toggle: set to false to disable all filtering
  enable_filtering: true

  # Archive zone - automatically excluded from all searches
  archive_zone: "loa-grimoire/archive/"

  # Signal threshold: exclude documents below this level
  # Options: low, medium, high
  # - high: Only include high-signal documents
  # - medium: Include medium and high (default)
  # - low: Include all (effectively no filtering)
  signal_threshold: "medium"

  # Patterns for low-signal documents to exclude
  default_excludes:
    - "**/brainstorm-*.md"
    - "**/session-notes-*.md"
    - "**/meeting-*.md"
    - "**/draft-*.md"
    - "**/scratch-*.md"
    - "**/temp-*.md"

  # Auto-archive drafts older than N days (0 = disabled)
  draft_ttl_days: 30

  # Frontmatter signal marker support
  respect_frontmatter_signals: true

# =============================================================================
# Lossless Ledger Protocol (v0.9.0)
# =============================================================================
# Paradigm: "Clear, Don't Compact" - Synthesize to ledgers before clearing

# Grounding Enforcement - requires citations for claims
grounding:
  # Minimum ratio of grounded claims (citations + code_references) to total claims
  threshold: 0.95
  # Enforcement level: strict (block /clear), warn (warn only), disabled
  enforcement: warn
  # Negative grounding for Ghost Features
  negative:
    enabled: true
    # Similarity threshold for semantic search (below = "not found")
    similarity_threshold: 0.4
    # Require 2 diverse queries for verification
    require_diverse_queries: true

# Attention Budget - advisory thresholds for context management
attention_budget:
  # Green zone: under this, no action needed
  green_threshold: 2000
  # Yellow zone: trigger delta-synthesis
  yellow_threshold: 5000
  # Orange zone: recommend /clear
  orange_threshold: 7500
  # Red zone: strong recommendation for /clear
  red_threshold: 10000
  # Advisory only (never blocks, just warns)
  advisory_only: true

# Session Continuity - recovery after /clear or new session
session_continuity:
  # Enable tiered recovery (Level 1/2/3)
  tiered_recovery: true
  # Level 1 recovery token budget (~100 tokens)
  level1_tokens: 100
  # Level 2 recovery token budget (~500 tokens)
  level2_tokens: 500
  # Auto-load Session Continuity section on session start
  auto_restore: true

# Synthesis Checkpoint - pre-clear validation
synthesis_checkpoint:
  # Enable blocking validation before /clear
  enabled: true
  # Grounding threshold for checkpoint (defaults to grounding.threshold)
  grounding_threshold: 0.95
  # EDD minimum test scenarios per decision
  edd:
    enabled: true
    min_test_scenarios: 3
    warn_only: true

# JIT Retrieval - lightweight identifiers instead of eager loading
jit_retrieval:
  # Prefer ck for semantic search when available
  prefer_ck: true
  # Enable fallback to grep/sed when ck unavailable
  fallback_enabled: true
  # Maximum lines to retrieve at once
  max_line_range: 100

# =============================================================================
# Behavior Preferences
# =============================================================================
preferences:
  auto_bead_on_review: true
  require_security_audit: true
  confirm_app_writes: true

# =============================================================================
# Frame System (Loa v5.0.0)
# =============================================================================
# Cognitive modes with invisible context-switching
frames:
  # Enable frame detection
  enabled: true
  # Infer frame from context (commands, file patterns, actions)
  auto_detect: true
  # Default frame when no signal detected
  default: search
  # Show status line: {symbol} {FRAME} · {context} · {status}
  status_line: true

# =============================================================================
# Taste Capture (Loa v5.0.0)
# =============================================================================
# Component taste extraction and governance
taste:
  # Enable /taste command
  enabled: true
  # Path to vocabulary file (null = freeform @intent)
  # Set by HivemindOS when connected, or use local vocabulary
  vocabulary_path: null
  # Require Gold graduation for key components
  require_graduation: false
  # Auto-generate proto-bead on Gold signature
  auto_proto_bead: true

# =============================================================================
# Proto-Beads (Loa v5.0.0)
# =============================================================================
# Local decision capture for components
proto_beads:
  # Enable proto-bead generation
  enabled: true
  # Local storage path
  local_path: "loa-grimoire/proto-beads/"

# =============================================================================
# HivemindOS Integration (Loa v5.0.0)
# =============================================================================
# Bridge to organizational context layer (optional, paid)
hivemind:
  # Connection status (set to true when HivemindOS is configured)
  connected: false
  # HivemindOS API endpoint (null when not connected)
  endpoint: null
  # Organization vocabulary for @intent validation
  vocabulary_path: "hivemind/vocabulary.md"
  # North Star for alignment checking
  north_star_path: "hivemind/north-star.md"
  # Sync behavior
  sync:
    # Auto-sync proto-beads on Gold signature
    auto: true
    # Prompt for "why" enrichment during sync
    prompt_why: true
